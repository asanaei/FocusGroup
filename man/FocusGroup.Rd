% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/FocusGroup.R
\name{FocusGroup}
\alias{FocusGroup}
\title{FocusGroup R6 Class}
\description{
Main R6 class for managing and running a focus group simulation.
It orchestrates the simulation through distinct phases (Opening, Icebreaker,
Engagement, Exploration, Closing) guided by a question script, manages agent
interactions via a turn-taking flow, and provides methods for analysis and
visualization of the conversation.
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{topic}}{Character. The main topic of the focus group discussion.}

\item{\code{purpose}}{Character. The primary purpose or research objective of conducting the focus group.}

\item{\code{agents}}{Named list. A list of `FGAgent` objects participating in the simulation, indexed by their IDs.}

\item{\code{moderator_id}}{Character. The ID of the agent designated as the moderator.}

\item{\code{conversation_log}}{List. A chronological log of all messages. Each message is a list:
`turn`, `speaker_id`, `is_moderator`, `text`, `timestamp`, `phase`.}

\item{\code{turn_taking_flow}}{A `ConversationFlow` object dictating participant turn-taking.}

\item{\code{prompt_templates}}{List. Holds prompt templates for agent/moderator actions.}

\item{\code{question_script}}{List. A structured list defining phases and specific questions/actions for the moderator.
Each element is a list with `phase` (e.g., "opening", "icebreaker_question") and optionally `text` (for specific questions).}

\item{\code{current_phase_index}}{Integer. Tracks the current position in the `question_script`.}

\item{\code{current_question_text}}{Character. Text of the current question being discussed.}

\item{\code{current_conversation_summary}}{Character. An LLM-generated summary of earlier parts of the conversation,
used for managing context length in prompts.}

\item{\code{llm_config_admin}}{An `llm_config` object for group-level LLM tasks (summarization, analysis).}

\item{\code{max_tokens_utterance}}{Integer. Default max tokens for participant utterances.}

\item{\code{max_tokens_moderator}}{Integer. Default max tokens for moderator utterances.}

\item{\code{max_tokens_desire}}{Integer. Default max tokens for desire-to-talk queries.}

\item{\code{total_tokens_sent}}{Numeric. Total tokens sent across all LLM calls in the group.}

\item{\code{total_tokens_received}}{Numeric. Total tokens received across all LLM calls.}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-FocusGroup-new}{\code{FocusGroup$new()}}
\item \href{#method-FocusGroup-run_simulation}{\code{FocusGroup$run_simulation()}}
\item \href{#method-FocusGroup-advance_turn}{\code{FocusGroup$advance_turn()}}
\item \href{#method-FocusGroup-summarize}{\code{FocusGroup$summarize()}}
\item \href{#method-FocusGroup-analyze}{\code{FocusGroup$analyze()}}
\item \href{#method-FocusGroup-analyze_topics}{\code{FocusGroup$analyze_topics()}}
\item \href{#method-FocusGroup-analyze_tfidf}{\code{FocusGroup$analyze_tfidf()}}
\item \href{#method-FocusGroup-analyze_readability}{\code{FocusGroup$analyze_readability()}}
\item \href{#method-FocusGroup-analyze_themes}{\code{FocusGroup$analyze_themes()}}
\item \href{#method-FocusGroup-analyze_sentiment}{\code{FocusGroup$analyze_sentiment()}}
\item \href{#method-FocusGroup-analyze_statistics}{\code{FocusGroup$analyze_statistics()}}
\item \href{#method-FocusGroup-analyze_participation_balance}{\code{FocusGroup$analyze_participation_balance()}}
\item \href{#method-FocusGroup-analyze_response_patterns}{\code{FocusGroup$analyze_response_patterns()}}
\item \href{#method-FocusGroup-analyze_question_patterns}{\code{FocusGroup$analyze_question_patterns()}}
\item \href{#method-FocusGroup-analyze_key_phrases}{\code{FocusGroup$analyze_key_phrases()}}
\item \href{#method-FocusGroup-plot_participation_timeline}{\code{FocusGroup$plot_participation_timeline()}}
\item \href{#method-FocusGroup-plot_word_count_distribution}{\code{FocusGroup$plot_word_count_distribution()}}
\item \href{#method-FocusGroup-plot_participation_by_agent}{\code{FocusGroup$plot_participation_by_agent()}}
\item \href{#method-FocusGroup-plot_turn_length_timeline}{\code{FocusGroup$plot_turn_length_timeline()}}
\item \href{#method-FocusGroup-clone}{\code{FocusGroup$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-new"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new FocusGroup simulation.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$new(
  topic,
  purpose,
  agents,
  moderator_id,
  turn_taking_flow,
  question_script = list(),
  prompt_templates = list(),
  llm_config_admin = NULL,
  max_tokens_config = list()
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{topic}}{Character. The main discussion topic.}

\item{\code{purpose}}{Character. The primary purpose of the focus group.}

\item{\code{agents}}{Named list of initialized `FGAgent` objects.}

\item{\code{moderator_id}}{Character. The ID of the agent acting as moderator.}

\item{\code{turn_taking_flow}}{An initialized `ConversationFlow` object.}

\item{\code{question_script}}{List. Moderator's script defining phases and questions.
If empty, a minimal default script (opening, generic discussion, closing) is used.}

\item{\code{prompt_templates}}{List. Custom prompt templates. Defaults are used if not provided.}

\item{\code{llm_config_admin}}{An `llm_config` object for administrative LLM tasks (e.g., summarization, LLM-based analysis).
If NULL, the moderator's `model_config` will be used for these tasks.}

\item{\code{max_tokens_config}}{List. Optional. Named list with `utterance`, `moderator`, `desire`
to override default max token limits for these LLM call types.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-run_simulation"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-run_simulation}{}}}
\subsection{Method \code{run_simulation()}}{
Run the full focus group simulation.
Iterates through the `question_script` phases or a specified number of turns.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$run_simulation(num_turns = NULL, verbose = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{num_turns}}{Integer. Optional. Maximum number of turns to run. If `NULL` (default),
the simulation runs until the `question_script` is exhausted or the moderator
decides to end. If both `num_turns` and `question_script` are provided,
the simulation stops at whichever condition is met first.}

\item{\code{verbose}}{Logical. If `TRUE`, prints progress and utterances to the console.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns the `conversation_log`.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-advance_turn"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-advance_turn}{}}}
\subsection{Method \code{advance_turn()}}{
Advance the simulation by one logical step (moderator action + participant response if applicable).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$advance_turn(current_turn_number, verbose = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{current_turn_number}}{Integer. The current turn number for logging.}

\item{\code{verbose}}{Logical. If `TRUE`, print progress.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Logical. `TRUE` if the simulation should continue, `FALSE` if it should end.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-summarize"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-summarize}{}}}
\subsection{Method \code{summarize()}}{
Generate a summary of the conversation using an LLM.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$summarize(
  llm_config = NULL,
  summary_level = 1,
  max_tokens = NULL,
  internal_call = FALSE,
  transcript_override = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{llm_config}}{An `llm_config` object for the summarization LLM. If `NULL`, uses `self$llm_config_admin`.}

\item{\code{summary_level}}{Integer (1-3). 1: Prose overview, 2: Detailed bulleted, 3: Short bulleted takeaways.}

\item{\code{max_tokens}}{Integer. Optional. Max tokens for the summary.}

\item{\code{internal_call}}{Logical. If TRUE, this is an internal call (e.g. for context window management) and token counts are not added to the agent who "owns" llm_config_admin.}

\item{\code{transcript_override}}{Character. Optional. If provided, this transcript is summarized instead of `self$conversation_log`.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Character string containing the generated summary.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze}{}}}
\subsection{Method \code{analyze()}}{
Basic analysis of the conversation log.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze(turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze. If `NULL`, analyzes all turns.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze. If `NULL`, analyzes all speakers.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with `speaker_stats` (a tibble: speaker_id, utterance_count, total_words, avg_words_per_utterance)
        and `full_transcript` (character string).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_topics"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_topics}{}}}
\subsection{Method \code{analyze_topics()}}{
Perform LDA topic modeling on the conversation.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_topics(
  num_topics = 5,
  min_doc_length = 20,
  top_n_terms = 10,
  turns = NULL,
  speaker_ids = NULL,
  ...
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{num_topics}}{Integer. Number of topics to identify.}

\item{\code{min_doc_length}}{Integer. Min words for a speaker's aggregated text to be a document.}

\item{\code{top_n_terms}}{Integer. Number of top terms per topic to return.}

\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}

\item{\code{...}}{Additional arguments to `topicmodels::LDA()`.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with LDA model, topic terms, and document-topic proportions. `NULL` on failure.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_tfidf"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_tfidf}{}}}
\subsection{Method \code{analyze_tfidf()}}{
Calculate TF-IDF scores for terms per participant.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_tfidf(
  top_n_terms = 10,
  turns = NULL,
  speaker_ids = NULL,
  ...
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{top_n_terms}}{Integer. Number of top TF-IDF terms per participant.}

\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}

\item{\code{...}}{Additional arguments to `tidytext::unnest_tokens`.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A tibble with TF-IDF scores.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_readability"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_readability}{}}}
\subsection{Method \code{analyze_readability()}}{
Calculate readability scores for each participant's aggregated text.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_readability(
  measures = "Flesch",
  turns = NULL,
  speaker_ids = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{measures}}{Character vector. Readability measure(s) from `quanteda.textstats::textstat_readability`.}

\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A tibble with readability scores.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_themes"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_themes}{}}}
\subsection{Method \code{analyze_themes()}}{
Perform LLM-assisted thematic analysis on the transcript.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_themes(llm_config = NULL, turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{llm_config}}{An `llm_config` object for the analysis. If `NULL`, uses `self$llm_config_admin`.}

\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with `themes_summary` (character string from LLM) and `raw_llm_response`.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_sentiment"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_sentiment}{}}}
\subsection{Method \code{analyze_sentiment()}}{
Perform sentiment analysis per utterance using tidytext.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_sentiment(
  sentiment_lexicon = "afinn",
  turns = NULL,
  speaker_ids = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{sentiment_lexicon}}{Character. Sentiment lexicon to use: "afinn", "bing", or "nrc".}

\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A tibble with `turn`, `speaker_id`, `text`, `sentiment`, `sentiment_score`.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_statistics"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_statistics}{}}}
\subsection{Method \code{analyze_statistics()}}{
Perform statistical analysis on conversation patterns.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_statistics(turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with ANOVA results, phase participation stats, and correlations.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_participation_balance"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_participation_balance}{}}}
\subsection{Method \code{analyze_participation_balance()}}{
Analyze participation balance and dominance patterns.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_participation_balance(turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with participation statistics and balance metrics.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_response_patterns"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_response_patterns}{}}}
\subsection{Method \code{analyze_response_patterns()}}{
Analyze response patterns and interaction behaviors.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_response_patterns(turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with response and interaction pattern metrics.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_question_patterns"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_question_patterns}{}}}
\subsection{Method \code{analyze_question_patterns()}}{
Analyze question asking patterns during the conversation.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_question_patterns(turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with question pattern analysis.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-analyze_key_phrases"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-analyze_key_phrases}{}}}
\subsection{Method \code{analyze_key_phrases()}}{
Extract and analyze key phrases using n-grams.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$analyze_key_phrases(min_freq = 2, turns = NULL, speaker_ids = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{min_freq}}{Integer. Minimum frequency for phrases to be considered key.}

\item{\code{turns}}{Integer vector. Optional. Specific turns to analyze.}

\item{\code{speaker_ids}}{Character vector. Optional. Specific speakers to analyze.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A list with bigram and trigram analysis.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-plot_participation_timeline"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-plot_participation_timeline}{}}}
\subsection{Method \code{plot_participation_timeline()}}{
Create participation timeline plot showing cumulative turns by participant across phases.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$plot_participation_timeline()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
ggplot object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-plot_word_count_distribution"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-plot_word_count_distribution}{}}}
\subsection{Method \code{plot_word_count_distribution()}}{
Create word count distribution plot showing message length patterns.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$plot_word_count_distribution()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
ggplot object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-plot_participation_by_agent"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-plot_participation_by_agent}{}}}
\subsection{Method \code{plot_participation_by_agent()}}{
Create participation by agent plot showing total turns per participant.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$plot_participation_by_agent()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
ggplot object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-plot_turn_length_timeline"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-plot_turn_length_timeline}{}}}
\subsection{Method \code{plot_turn_length_timeline()}}{
Create turn length timeline plot showing message length evolution over time.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$plot_turn_length_timeline()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
ggplot object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-FocusGroup-clone"></a>}}
\if{latex}{\out{\hypertarget{method-FocusGroup-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FocusGroup$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
